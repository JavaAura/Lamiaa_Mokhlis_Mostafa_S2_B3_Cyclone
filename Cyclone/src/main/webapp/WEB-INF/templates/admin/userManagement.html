<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Management - Cyclone</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
	tailwind.config = {
		theme : {
			extend : {
				colors : {
					primary : '#FF0000',
					secondary : '#000000',
				}
			}
		}
	}
</script>
</head>

<body class="bg-gray-100">
	<!-- Top navbar -->
	<nav class="bg-secondary text-white">
		<div
			class="container mx-auto px-4 py-3 flex justify-between items-center">
			<div class="text-2xl font-bold">
				<span class="text-primary">C</span>yclone
			</div>
			<div>878-9674-4455</div>
		</div>
	</nav>

	<!-- Menu navbar -->
	<div class="bg-primary">
		<div class="container mx-auto px-4">
			<ul class="flex justify-center space-x-6 py-4">
				<li><a href="accueil.html"
					class="text-white font-bold hover:text-secondary">Accueil</a></li>
				<li><a href="produits.html"
					class="text-white font-bold hover:text-secondary">Produits</a></li>
				<li><a href="gestion-commandes.html"
					class="text-white font-bold hover:text-secondary">Commandes</a></li>
				<li><a href="gestion-utilisateurs.html"
					class="text-white font-bold hover:text-secondary">Utilisateurs</a></li>
				<li><a href="contact.html"
					class="text-white font-bold hover:text-secondary">Contact</a></li>
			</ul>
		</div>
	</div>

	<div class="container mx-auto px-4 py-8">
		<!-- Logout Form -->
		<form th:action="@{/auth}" method="post">
			<input type="hidden" name="action" value="logout">
			<button type="submit"
				class="bg-primary text-white px-4 py-2 rounded-lg">Logout</button>
		</form>

		<h1 class="text-3xl font-bold mb-6 text-secondary">User
			Management</h1>

		<!-- Toggle Button for Clients Table -->
		<div class="mb-4">
			<button id="toggleButton" onclick="toggleTables()"
				class="bg-primary text-white px-4 py-2 rounded-lg">Show
				Clients</button>
		</div>

		<!-- Error and Message Alerts -->
		<p th:text="${error}" class="text-red-500">Error message here</p>
		<p th:text="${message}" class="text-green-500">Message here</p>

		<!-- Search Input -->
		<div class="mb-4">
			<input id="searchInput" type="text"
				placeholder="Rechercher un utilisateur..."
				class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"
				onkeyup="filterUsers()">
		</div>

		<!-- Add User Button -->
		<div class="mb-4 flex justify-end">
			<button onclick="showUserForm()"
				class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-red-600">Add
				user</button>
		</div>

		<!-- Admin Table -->
		<div id="adminTable" class="container mx-auto px-4 py-8">
			<h2 class="text-lg font-bold mb-4">Admins</h2>
			<table class="min-w-full table-auto">
				<thead>
					<tr>
						<th class="px-6 py-3 text-left">ID</th>
						<th class="px-6 py-3 text-left">Full Name</th>
						<th class="px-6 py-3 text-left">Email</th>
						<th class="px-6 py-3 text-left">Role</th>
						<th class="px-6 py-3 text-left">Access level</th>
						<th class="px-6 py-3 text-left">Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${emptyTable}">
						<td colspan="6" class="text-center" th:text="${emptyTable}">No
							data available.</td>
					</tr>
					<tr th:each="user : ${admins}">
						<td class="border-t px-6 py-4" th:text="${user.id}"></td>
						<td class="border-t px-6 py-4"
							th:text="${user.firstName} + ' ' + ${user.lastName}"></td>
						<td class="border-t px-6 py-4" th:text="${user.email}"></td>
						<td class="border-t px-6 py-4" th:text="${user.role}"></td>
						<td class="border-t px-6 py-4" th:text="${user.accessLevel}"></td>
						<td class="border-t px-6 py-4"><a
							th:href="@{/user(action='edit', userID=${user.id})}"
							class="text-blue-500 hover:text-blue-700">Edit</a> <a
							th:href="@{/user(action='delete', userID=${user.id})}"
							class="text-red-500 hover:text-red-700 ml-2"
							onclick="return confirm('Are you sure you want to delete this admin?');">
								Delete </a></td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Client Table (Initially Hidden) -->
		<div id="clientTable" class="container mx-auto px-4 py-8 hidden">
			<h2 class="text-lg font-bold mb-4">Clients</h2>
			<table class="min-w-full table-auto">
				<thead>
					<tr>
						<th class="px-6 py-3 text-left">ID</th>
						<th class="px-6 py-3 text-left">Full Name</th>
						<th class="px-6 py-3 text-left">Email</th>
						<th class="px-6 py-3 text-left">Role</th>
						<th class="px-6 py-3 text-left">Delivery Address</th>
						<th class="px-6 py-3 text-left">Payment Method</th>
						<th class="px-6 py-3 text-left">Actions</th>
					</tr>
				</thead>
				<tbody>
					<tr th:if="${emptyTable}">
						<td colspan="7" class="text-center" th:text="${emptyTable}">No
							data available.</td>
					</tr>
					<tr th:each="user : ${clients}">
						<td class="border-t px-6 py-4" th:text="${user.id}"></td>
						<td class="border-t px-6 py-4"
							th:text="${user.firstName} + ' ' + ${user.lastName}"></td>
						<td class="border-t px-6 py-4" th:text="${user.email}"></td>
						<td class="border-t px-6 py-4" th:text="${user.role}"></td>
						<td class="border-t px-6 py-4" th:text="${user.deliveryAddress}"></td>
						<td class="border-t px-6 py-4" th:text="${user.paymentMethod}"></td>
						<td class="border-t px-6 py-4"><a
							th:href="@{/user(action='edit', userID=${user.id})}"
							class="text-blue-500 hover:text-blue-700">Edit</a> <a
							th:href="@{/user(action='delete', userID=${user.id})}"
							class="text-red-500 hover:text-red-700 ml-2"
							onclick="return confirm('Are you sure you want to delete this client?');">
								Delete </a>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Modal for User Form -->
		<div id="userFormModal"
			class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
			<div
				class="relative top-20 mx-auto p-5 border w-5/12 shadow-lg rounded-md bg-white">
				<h3 id="modalTitle" class="text-lg font-bold mb-4">Add User</h3>
				<form id="userForm" th:action="@{/user}" method="POST">
					<input type="hidden" name="action" value="insert">
					<div class="flex justify-between gap-8">
						<div class="mb-4 w-full">
							<label for="userName"
								class="block text-gray-700 text-sm font-bold mb-2">First
								name</label> <input type="text" id="userName" name="firstName" required
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
						<div class="mb-4 w-full">
							<label for="userLastName"
								class="block text-gray-700 text-sm font-bold mb-2">Last
								name</label> <input type="text" id="userLastName" name="lastName"
								required
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
					</div>
					<div class="flex justify-between gap-8">
						<div class="mb-4 w-full">
							<label for="userEmail"
								class="block text-gray-700 text-sm font-bold mb-2">Email</label>
							<input type="email" id="userEmail" name="email" required
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
						<div class="mb-4 w-full">
							<label for="userPassword"
								class="block text-gray-700 text-sm font-bold mb-2">Password</label>
							<input type="password" id="userPassword" name="password" required
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
					</div>
					<div class="mb-4">
						<label for="userRole"
							class="block text-gray-700 text-sm font-bold mb-2">Role</label> <select
							id="userRole" onchange="toggleRoleFields()" name="role" required
							class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
							<option value="Admin">Admin</option>
							<option value="Client">Client</option>
						</select>
					</div>

					<!-- Admin-specific fields -->
					<div id="adminFields" class="hidden">
						<div class="mb-4">
							<label for="userAccessLevel"
								class="block text-gray-700 text-sm font-bold mb-2">Access
								level</label> <input type="text" id="userAccessLevel" name="accessLevel"
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
					</div>

					<!-- Client-specific fields -->
					<div id="clientFields" class="hidden">
						<div class="mb-4">
							<label for="userDeliveryAddress"
								class="block text-gray-700 text-sm font-bold mb-2">Delivery
								address</label> <input type="text" id="userDeliveryAddress"
								name="deliveryAddress"
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
						<div class="mb-4">
							<label for="userPaymentMethod"
								class="block text-gray-700 text-sm font-bold mb-2">Payment
								method</label> <input type="text" id="userPaymentMethod"
								name="paymentMethod"
								class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
						</div>
					</div>

					<div class="flex justify-end">
						<button type="button" onclick="closeUserForm()"
							class="mr-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
						<button type="submit"
							class="px-4 py-2 bg-primary text-white rounded-md hover:bg-red-600">Save</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<script>
		function toggleTables() {
			const adminTable = document.getElementById('adminTable');
			const clientTable = document.getElementById('clientTable');
			const toggleButton = document.getElementById('toggleButton');

			if (adminTable.classList.contains('hidden')) {
				adminTable.classList.remove('hidden');
				clientTable.classList.add('hidden');
				toggleButton.textContent = "Show Clients";
			} else {
				adminTable.classList.add('hidden');
				clientTable.classList.remove('hidden');
				toggleButton.textContent = "Show Admins";
			}
		}

		// Function to show and hide fields based on role selection
		function toggleRoleFields() {
			const role = document.getElementById('userRole').value;
			const adminFields = document.getElementById('adminFields');
			const clientFields = document.getElementById('clientFields');

			// Hide both fields initially
			adminFields.classList.add('hidden');
			clientFields.classList.add('hidden');

			// Show the relevant fields based on role selection
			if (role === 'Admin') {
				adminFields.classList.remove('hidden');
			} else if (role === 'Client') {
				clientFields.classList.remove('hidden');
			}
		}

		// Initialize form on page load by checking the selected role
		document.addEventListener('DOMContentLoaded', function() {
			toggleRoleFields();
		});

		function showUserForm() {
			document.getElementById('userFormModal').classList.remove('hidden');
			document.getElementById('modalTitle').textContent = 'Add User';
			document.getElementById('userForm').reset();
			editingUserId = null;
		}

		function closeUserForm() {
			document.getElementById('userFormModal').classList.add('hidden');
		}
	</script>
</body>

</html>
