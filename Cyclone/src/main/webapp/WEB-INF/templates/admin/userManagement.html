<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - Cyclone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF0000',
                        secondary: '#000000',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100">
    <!-- Top navbar -->
    <nav class="bg-secondary text-white">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold">
                <span class="text-primary">C</span>yclone
            </div>
            <div>
                878-9674-4455
            </div>
        </div>
    </nav>

    <!-- Menu navbar -->
    <div class="bg-primary">
        <div class="container mx-auto px-4">
            <ul class="flex justify-center space-x-6 py-4">
                <li><a href="accueil.html" class="text-white font-bold hover:text-secondary">Accueil</a></li>
                <li><a href="produits.html" class="text-white font-bold hover:text-secondary">Produits</a></li>
                <li><a href="gestion-commandes.html" class="text-white font-bold hover:text-secondary">Commandes</a></li>
                <li><a href="gestion-utilisateurs.html" class="text-white font-bold hover:text-secondary">Utilisateurs</a></li>
                <li><a href="contact.html" class="text-white font-bold hover:text-secondary">Contact</a></li>
            </ul>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
    	<form th:action="@{/auth}" method="post">
    		<input type="hidden" name="action" value="logout">
    		<button type="submit" class="">Logout</button>
		</form>
        <h1 class="text-3xl font-bold mb-6 text-secondary">User Management</h1>
        
        <p th:text="${error}">Error message here</p>
        <p th:text="${message}">message here</p>

        <div class="mb-4">
            <input id="searchInput" type="text" placeholder="Rechercher un utilisateur..." class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"
                onkeyup="filterUsers()">
        </div>

        <div class="mb-4 flex justify-end">
            <button onclick="showUserForm()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-red-600">Add user</button>
        </div>

        <div class="overflow-x-auto bg-white rounded-lg shadow overflow-y-auto relative">
            <table class="border-collapse table-auto w-full whitespace-no-wrap bg-white table-striped relative">
                <thead>
                    <tr class="text-left">
                        <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">ID</th>
                        <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Nom</th>
                        <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Email</th>
                        <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Rôle</th>
                        <th class="bg-gray-100 sticky top-0 border-b border-gray-200 px-6 py-2 text-gray-600 font-bold tracking-wider uppercase text-xs">Actions</th>
                    </tr>
                </thead>
                <tbody id="userTableBody">
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="mt-4 flex justify-center">
            <nav id="pagination" class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                <!-- Pagination dynamically generated -->
            </nav>
        </div>
    </div>

    <!-- Modal for user form -->
    <div id="userFormModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-5/12 shadow-lg rounded-md bg-white">
        <h3 id="modalTitle" class="text-lg font-bold mb-4">Add User</h3>
        <form id="userForm" th:action="@{/user}" method="POST">
        	<input type="hidden" name="action" value="insert">
        	<div class="flex justify-between gap-8">
        		<div class="mb-4 w-full">
                	<label for="userName" class="block text-gray-700 text-sm font-bold mb-2">First name</label>
                	<input type="text" id="userName" name="firstName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
            	</div>
            	<div class="mb-4 w-full">
                	<label for="userLastName" class="block text-gray-700 text-sm font-bold mb-2">Last name</label>
                	<input type="text" id="userLastName" name="lastName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
            	</div>
        	</div>
        	<div class="flex justify-between gap-8">
        		<div class="mb-4 w-full">
                	<label for="userEmail" class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                	<input type="email" id="userEmail" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
            	</div>
            	<div class="mb-4 w-full">
               		<label for="userPassword" class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                	<input type="password" id="userPassword" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
            	</div>
        	</div>
            <div class="mb-4">
                <label for="userRole" class="block text-gray-700 text-sm font-bold mb-2">Role</label>
                <select id="userRole" name="role" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary" onchange="toggleRoleFields()">
                    <option value="Client">Client</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>

            <!-- Admin-specific fields -->
            <div id="adminFields" class="hidden">
                <div class="mb-4">
                    <label for="userAccessLevel" class="block text-gray-700 text-sm font-bold mb-2">Access level</label>
                    <input type="text" id="userAccessLevel" name="accessLevel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <!-- Client-specific fields -->
            <div id="clientFields" class="hidden">
                <div class="mb-4">
                    <label for="userDeliveryAddress" class="block text-gray-700 text-sm font-bold mb-2">Delivery address</label>
                    <input type="text" id="userDeliveryAddress" name="deliveryAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="mb-4">
                    <label for="userPaymentMethod" class="block text-gray-700 text-sm font-bold mb-2">Payment method</label>
                    <input type="text" id="userPaymentMethod" name="paymentMethod" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
            </div>

            <div class="flex justify-end">
                <button type="button" onclick="closeUserForm()" class="mr-2 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-red-600">Save</button>
            </div>            
        </form>
    </div>
</div>

<script>
    // Function to show and hide fields based on role selection
    function toggleRoleFields() {
        const role = document.getElementById('userRole').value;
        const adminFields = document.getElementById('adminFields');
        const clientFields = document.getElementById('clientFields');

        // Hide both fields initially
        adminFields.classList.add('hidden');
        clientFields.classList.add('hidden');

        // Show the relevant fields based on role selection
        if (role === 'Admin') {
            adminFields.classList.remove('hidden');
        } else if (role === 'Client') {
            clientFields.classList.remove('hidden');
        }
    }

    // Initialize form on page load by checking the selected role
    document.addEventListener('DOMContentLoaded', function () {
        toggleRoleFields();
    });
</script>


    <script>
        // Simulons des données d'utilisateurs
        let users = [
            { id: 1, name: 'John Doe', email: 'john@example.com', role: 'Admin' },
            { id: 2, name: 'Jane Smith', email: 'jane@example.com', role: 'Client' },
            { id: 3, name: 'Bob Johnson', email: 'bob@example.com', role: 'Client' },
        ];

        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredUsers = [...users];
        let editingUserId = null;

        function populateUserTable() {
            const tableBody = document.getElementById('userTableBody');
            tableBody.innerHTML = '';

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const paginatedUsers = filteredUsers.slice(start, end);

            paginatedUsers.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border-dashed border-t border-gray-200 px-6 py-4">${user.id}</td>
                    <td class="border-dashed border-t border-gray-200 px-6 py-4">${user.name}</td>
                    <td class="border-dashed border-t border-gray-200 px-6 py-4">${user.email}</td>
                    <td class="border-dashed border-t border-gray-200 px-6 py-4">${user.role}</td>
                    <td class="border-dashed border-t border-gray-200 px-6 py-4">
                        <button onclick="editUser(${user.id})" class="text-blue-500 hover:text-blue-700">Modifier</button>
                        <button onclick="deleteUser(${user.id})" class="text-red-500 hover:text-red-700 ml-2">Supprimer</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredUsers.length / itemsPerPage);
            const paginationElement = document.getElementById('pagination');
            paginationElement.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.innerText = i;
                pageButton.classList.add('bg-white', 'border-gray-300', 'text-gray-500', 'hover:bg-gray-50', 'relative', 'inline-flex', 'items-center', 'px-4', 'py-2', 'border', 'text-sm', 'font-medium');
                if (i === currentPage) {
                    pageButton.classList.add('bg-primary', 'text-white');
                }
                pageButton.onclick = () => {
                    currentPage = i;
                    populateUserTable();
                };
                paginationElement.appendChild(pageButton);
            }
        }

        function filterUsers() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            filteredUsers = users.filter(user => 
                user.name.toLowerCase().includes(query) || 
                user.email.toLowerCase().includes(query) ||
                user.role.toLowerCase().includes(query)
            );
            currentPage = 1;
            populateUserTable();
        }

        function showUserForm() {
            document.getElementById('userFormModal').classList.remove('hidden');
            document.getElementById('modalTitle').textContent = 'Add User';
            document.getElementById('userForm').reset();
            editingUserId = null;
        }

        function closeUserForm() {
            document.getElementById('userFormModal').classList.add('hidden');
        }

        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user) {
                document.getElementById('modalTitle').textContent = 'Modifier un utilisateur';
                document.getElementById('userName').value = user.name;
                document.getElementById('userEmail').value = user.email;
                document.getElementById('userRole').value = user.role;
                editingUserId = id;
                showUserForm();
            }
        }

        function deleteUser(id) {
            if (confirm('Are you sure you want to delete this user ?')) {
                users = users.filter(u => u.id !== id);
                filteredUsers = filteredUsers.filter(u => u.id !== id);
                populateUserTable();
            }
        }

        document.getElementById('userForm').addEventListener('submit', function(e) {
            /* e.preventDefault();
            const formData = new FormData(e.target);
            const userData = Object.fromEntries(formData.entries());
            
            if (editingUserId) {
                // Update existing user
                const index = users.findIndex(u => u.id === editingUserId);
                if (index !== -1) {
                    users[index] = { ...users[index], ...userData };
                }
            } else {
                // Add new user
                const newId = Math.max(...users.map(u => u.id)) + 1;
                users.push({ id: newId, ...userData });
            }

            filteredUsers = [...users];
            populateUserTable();
            closeUserForm(); */
        });

        // Initialize user table when the page loads
        window.onload = function () {
            populateUserTable();
        }
    </script>
</body>

</html>
