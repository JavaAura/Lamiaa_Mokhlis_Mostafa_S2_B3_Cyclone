<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF0000',
                        secondary: '#000000',
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-100">
    <!-- Top navbar -->
    <nav class="bg-secondary text-white">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="text-2xl font-bold">
                <span class="text-primary">C</span>yclone
            </div>
            <div>
                878-9674-4455
            </div>
        </div>
    </nav>

    <!-- Menu navbar -->
    <div class="bg-primary">
        <div class="container mx-auto px-4">
            <ul class="flex justify-center space-x-6 py-4">
                <li><a href="home.html" class="text-white font-bold hover:text-secondary">Home</a></li>
                <li><a href="products.html" class="text-white font-bold hover:text-secondary">Products</a></li>
                <li><a href="contact.html" class="text-white font-bold hover:text-secondary">Contact</a></li>
            </ul>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6 text-secondary">Product Management</h1>

        <!-- Search bar -->
        <div class="mb-4">
            <input id="searchInput" type="text" placeholder="Search for a product..." class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary">
        </div>

        <!-- Add product button -->
        <div class="mb-4 flex justify-end">
            <a href="?action=showForm" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-red-600">Add a product</a>
        </div>

        <!-- Error message as an alert -->
        <div th:if="${errorMessage}" class="mt-4 mx-auto max-w-lg bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative text-center" role="alert">
            <strong class="font-bold">Error !</strong>
            <span class="block sm:inline" th:text="${errorMessage}"></span>
        </div>

        <!-- Product table -->
        <table class="w-full bg-white shadow-md rounded-lg overflow-hidden">
            <thead class="bg-secondary text-white">
                <tr>
                    <th class="py-3 px-4 text-left">Name</th>
                    <th class="py-3 px-4 text-left">Description</th>
                    <th class="py-3 px-4 text-right">Price</th>
                    <th class="py-3 px-4 text-right">Stock</th>
                    <th class="py-3 px-4 text-center">Actions</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <tr th:each="product : ${products}">
                    <td class="py-3 px-4" th:text="${product.name}"></td>
                    <td class="py-3 px-4" th:text="${product.description}"></td>
                    <td class="py-3 px-4 text-right" th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' â‚¬'"></td>
                    <td class="py-3 px-4 text-right" th:text="${product.stock}"></td>
                    <td class="py-3 px-4 text-center">
                        <a th:href="@{/Product(action=showFormUpdate, id=${product.id})}" class="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">Edit</a>
                        <form th:action="@{/Product}" method="post" class="inline-block" onsubmit="return confirm('Are you sure you want to delete ' + this.getAttribute('data-product-name') + '?');" th:data-product-name="${product.name}">
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="id" th:value="${product.id}">
                            <button type="submit" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Pagination controls -->
        <div class="mt-4 flex justify-center">
            <button id="prevPage" class="bg-secondary text-white px-4 py-2 rounded-lg mr-2 hover:bg-gray-700">Previous</button>
            <span id="pageInfo" class="px-4 py-2">Page <span id="currentPage"></span> of <span id="totalPages"></span></span>
            <button id="nextPage" class="bg-secondary text-white px-4 py-2 rounded-lg ml-2 hover:bg-gray-700">Next</button>
        </div>
    </div>

    <script>
        // ... (JavaScript remains the same, only translating comments)
        let currentPage = 1;
        const itemsPerPage = 5;
        let filteredProducts = [];
        let allProducts = [];

        function filterProducts() {
            const input = document.getElementById('searchInput');
            const filter = input.value.toLowerCase().trim();
            
            if (filter === '') {
                // If the input is empty, reset to show all products
                filteredProducts = [...allProducts];
            } else {
                filteredProducts = allProducts.filter(row => {
                    const name = row.getElementsByTagName('td')[0];
                    const description = row.getElementsByTagName('td')[1];
                    if (name && description) {
                        const nameText = name.textContent || name.innerText;
                        const descriptionText = description.textContent || description.innerText;
                        return nameText.toLowerCase().indexOf(filter) > -1 || 
                               descriptionText.toLowerCase().indexOf(filter) > -1;
                    }
                    return false;
                });
            }

            currentPage = 1;
            displayProducts();
            updatePaginationInfo();
        }

        function displayProducts() {
            const tableBody = document.getElementById('productTableBody');
            tableBody.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const productsToShow = filteredProducts.slice(startIndex, endIndex);

            productsToShow.forEach(product => {
                const clonedProduct = product.cloneNode(true);
                // Reattach event listener for delete form
                const deleteForm = clonedProduct.querySelector('form');
                if (deleteForm) {
                    deleteForm.onsubmit = function() {
                        return confirm('Are you sure you want to delete ' + this.getAttribute('data-product-name') + '?');
                    };
                }
                tableBody.appendChild(clonedProduct);
            });
        }

        function updatePaginationInfo() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('totalPages').textContent = totalPages;

            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayProducts();
                updatePaginationInfo();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayProducts();
                updatePaginationInfo();
            }
        });

        // Initialize the table and pagination
        window.onload = function() {
            const table = document.querySelector('table');
            allProducts = Array.from(table.getElementsByTagName('tr')).slice(1); // Exclude header row
            filteredProducts = [...allProducts];
            displayProducts();
            updatePaginationInfo();

            // Add event listener for search input
            document.getElementById('searchInput').addEventListener('input', filterProducts);
        };
    </script>
</body>

</html>
